#nodejs之异步编程
##Node中两种相应逻辑管理方式：回调和事件监听。

- 回调通常用来定义一次性响应的逻辑。   
	回调是一个函数，它被当做参数传给异步函数，它描述了异步操作完成之后要做什么。   
	Node的异步回调惯例：node中的大多数内置模块在使用回调时都会带两个参数：第一个是用来放可能会发生的错误（常被缩写为er或err），第二个是放结构的
- 事件监听器，本质上也是一个回调，不同的是，它跟一个概念实体(事件)相关联。  
	用事件发射器处理重复性事件。       
	事件是通过监听器进行处理的，监听器是跟事件相关联的，带有一个事件出现时就会被触发的回调函数。   
	on方法监听的事件可持续不断地相应事件，once方法响应单次事件。   

##自定义事件发射器

创建代码demo7/index.js
 
	var EventEmitter = require('events').EventEmitter;
	var channel = new EventEmitter();
	
	/*//或写成
	var events = require('events');
	var channel = new events.EventEmitter();*/
	
	
	//用on方法给事件发射器添加监听器
	channel.on('join', function () {
	    console.log("自定义事件发射器");
	});
	
	//用emit函数发射这个事件
	channel.emit('join');
	
命令行执行：

	node demo7/index.js
	
命令行输出：

	自定义事件发射器
	
##扩展事件监听器

###让异步逻辑顺序执行
让一组异步任务顺序执行的概念被Node社区称为`流程控制`，这种控制分为两类：**串行和并行**

- 串行任务：需要一个接着一个做的任务
- 并行任务：不需要一个接着一个做的任务，这些任务彼此之间开始和结束的时间并不重要，但在后续逻辑执行之前他们应该全部做完。

跟踪串行和并行的流程控制要做编程记账的工作。   
在实现串行化流程控制时，需要跟踪当前执行的任务，或维护一个尚未执行任务的队列。   
实现并行化流程控制时需要跟踪有多少个任务要执行完成了。   

###什么时候使用串行流程控制

用回调让任务顺序执行

例：用setTimeout模拟需要花时间执行的任务：第一个任务用1秒，第二个用半秒，最后一个用十分之一秒。

	setTimeout(function () {
	    console.log("This is the first task!");
	    setTimeout(function () {
	        console.log("This is the next task!");
	        setTimeout(function () {
	            console.log("This is the last task!");
	        }, 100);
	    }, 500);
	}, 1000);
	
串行化流程控制本质上是在需要时让回调进场，而不是简单地把它们嵌套起来。

###实现并行化流程控制
为了让异步任务并行执行，仍然是要把任务放到数组中，但任务的存放顺序无关紧要，每个任务都应该调用处理器函数增加已完成任务的计数值。当所有任务都完成后，处理器函数应该执行后续的逻辑。